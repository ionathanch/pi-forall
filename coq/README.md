# StraTT syntactic metatheory

This mechanization has been checked with [Coq](https://coq.inria.fr/) 8.19.1,
compiled using OCaml 4.14.2,
and using the Metalib library for metatheory of locally nameless syntax.
These can be installed using [opam](https://opam.ocaml.org/):

```sh
opam repo add coq-released https://coq.inria.fr/opam/released
opam pin add coq 8.19.1
opam pin add coq-metalib https://github.com/plclub/metalib.git
```

Some files are generated using [Ott](https://github.com/ott-lang/ott) 0.33
and [LNgen](https://github.com/plclub/lngen) 0.3.2;
see their respective instructions for installation.
The files can be regenerated as follows:

```sh
ott -i ../StraTT.ott -o StraTT_ott.v -coq_lngen true -coq_expand_list_types true
lngen --coq StraTT_inf.v --coq-ott StraTT_ott ../StraTT.ott
```

Additionally, the `CoqSrc` files are generated by `coq_makefile -f _CoqProject -o CoqSrc.mk`.

## Expected output

The development can be compiled by `make -f CoqSrc.mk`,
with the following expected output when run in the VM.

```coq
COQDEP VFILES
COQC StraTT_ott.v
COQC StraTT_inf.v
COQC axioms.v
COQC tactics.v
COQC basics.v
COQC incr.v
COQC ctx.v
COQC restrict.v
COQC subst.v
COQC inversion.v
COQC typesafety.v
Axioms:
ineq_Type_Bottom : forall S : signature, DEquiv S a_Type a_Bottom -> False
ineq_Pi_Type
  : forall (S : signature) (B1 : tm) (j : Datatypes.nat) (B2 : tm),
    DEquiv S (a_Pi B1 j B2) a_Type -> False
ineq_Pi_Bottom
  : forall (S : signature) (B1 : tm) (j : Datatypes.nat) (B2 : tm),
    DEquiv S (a_Pi B1 j B2) a_Bottom -> False
ineq_Arrow_Type
  : forall (S : signature) (A1 A2 : tm),
    DEquiv S (a_Arrow A1 A2) a_Type -> False
ineq_Arrow_Pi
  : forall (S : signature) (A1 B1 A2 : tm) (j : Datatypes.nat) (B2 : tm),
    DEquiv S (a_Arrow A1 A2) (a_Pi B1 j B2) -> False
ineq_Arrow_Bottom
  : forall (S : signature) (A1 A2 : tm),
    DEquiv S (a_Arrow A1 A2) a_Bottom -> False
Eqdep.Eq_rect_eq.eq_rect_eq
  : forall (U : Type) (p : U) (Q : U -> Type) (x : Q p) (h : p = p),
    x = eq_rect p Q x p h
DEquiv_Pi_inj3
  : forall (S : signature) (A1 B1 : tm) (j1 j2 : Datatypes.nat)
      (A2 B2 a : tm),
    lc_tm a ->
    DEquiv S (a_Pi A1 j1 B1) (a_Pi A2 j2 B2) ->
    DEquiv S (open B1 a) (open B2 a)
DEquiv_Pi_inj2
  : forall (S : signature) (A1 B1 : tm) (j1 j2 : Datatypes.nat) (A2 B2 : tm),
    DEquiv S (a_Pi A1 j1 B1) (a_Pi A2 j2 B2) -> j1 = j2
DEquiv_Pi_inj1
  : forall (S : signature) (A1 B1 : tm) (j1 j2 : Datatypes.nat) (A2 B2 : tm),
    DEquiv S (a_Pi A1 j1 B1) (a_Pi A2 j2 B2) -> DEquiv S A1 A2
DEquiv_Arrow_inj2
  : forall (S : signature) (A1 B1 A2 B2 : tm),
    DEquiv S (a_Arrow A1 B1) (a_Arrow A2 B2) -> DEquiv S B1 B2
DEquiv_Arrow_inj1
  : forall (S : signature) (A1 B1 A2 B2 : tm),
    DEquiv S (a_Arrow A1 B1) (a_Arrow A2 B2) -> DEquiv S A1 A2
```

## Axioms

Because we use the `dependent induction` tactic from Coq.Program.Equality,
this development inherits the `eq_rect_eq` axiom (i.e. UIP) from Coq.Logic.Eqdep.
The remaining axioms governing the equational theory of the syntax are listed in the file axioms.v,
namely injectivity of function types and distinctness of head forms.
They have been proven in the Agda development.

## Contents

The proof files below are in approximate dependency order,
with the corresponding lemmas and theorems from the paper
that they contain in parentheses.

* `StraTT_ott.v`: Coq specification of the rules give in `../StraTT.ott`
* `StraTT_inf.v`: Lemmas about locally nameless representation generated by LNgen
* `axioms.v`: Injectivity of function types (Axiom 2),
  distinctness of head forms (Axiom 3)
* `tactics.v`: Tactics for working with Metalib
* `basics.v`: Basic lemmas about local closure and free variables
* `subst.v`: Substitution (Lemma 8)
* `incr.v`: Displacement, displaceability (Lemma 10)
* `ctx.v`: Context subsumption, weakening (Lemma 7),
  context regularity (Lemma 9), context restriction (Lemma 11)
* `restrict.v`: Restriction subsumption (Lemma 12), floating,
  restricted floating (Lemma 13), cumulativity (Lemma 14)
* `inversion.v`: Typing inversion, typing regularity (Lemma 9)
* `typesafety.v`: Context replacement, Preservation (Theorem 4), canonical forms,
  call-by-name reduction (Figure 10), progress (Theorem 5), type safety

## Statistics

```
github.com/AlDanial/cloc v 2.00  T=0.03 s (338.4 files/s, 126676.0 lines/s)
-------------------------------------------------------------------------------
File                             blank        comment           code
-------------------------------------------------------------------------------
StraTT_inf.v                       362            156           1065
StraTT_ott.v                        49             26            477
ctx.v                               53             17            323
typesafety.v                        21              9            322
restrict.v                          15              6            227
inversion.v                         18             20            219
basics.v                            38             10            205
subst.v                             11             15            204
incr.v                              14             14            121
tactics.v                            6              5             36
axioms.v                            14              9             31
-------------------------------------------------------------------------------
SUM:                               601            287           3230
-------------------------------------------------------------------------------
```