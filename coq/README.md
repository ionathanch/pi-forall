# StraTT syntactic metatheory

This mechanization has been checked with [Coq](https://coq.inria.fr/) 8.19.1,
compiled using OCaml 4.14.2,
and using the Metalib library for metatheory of locally nameless syntax.
These can be installed using [opam](https://opam.ocaml.org/):

```sh
opam repo add coq-released https://coq.inria.fr/opam/released
opam pin add coq 8.19.1
opam pin add coq-metalib https://github.com/plclub/metalib.git
```

Some files are generated using [Ott](https://github.com/ott-lang/ott) 0.33
and [LNgen](https://github.com/plclub/lngen) 0.3.2;
see their respective instructions for installation.
The files can be regenerated as follows:

```sh
ott -i ../StraTT.ott -o StraTT_ott.v -coq_lngen true -coq_expand_list_types true
lngen --coq StraTT_inf.v --coq-ott StraTT_ott ../StraTT.ott
```

Additionally, the `CoqSrc` files are generated by `coq_makefile -f _CoqProject -o CoqSrc.mk`.

## Axioms

Because we use the `dependent induction` tactic from Coq.Program.Equality,
this development inherits the `eq_rect_eq` axiom (i.e. UIP) from Coq.Logic.Eqdep.
The remaining axioms governing the equational theory of the syntax are listed in the file axioms.v,
namely injectivity of function types and distinctness of head forms.
They have been proven in the Agda development.

## Contents

The proof files below are in approximate dependency order,
with the corresponding lemmas and theorems from the paper
that they contain in parentheses.
They are also marked in the proof files by comments
"Axiom/Lemma/Theorem <n> (<description>) in the paper".

* `StraTT_ott.v`: Coq specification of the rules give in `../StraTT.ott`
* `StraTT_inf.v`: Lemmas about locally nameless representation generated by LNgen
* `axioms.v`: Injectivity of function types (Axiom 2),
  distinctness of head forms (Axiom 3)
* `tactics.v`: Tactics for working with Metalib
* `basics.v`: Basic lemmas about local closure and free variables
* `subst.v`: Substitution (Lemma 8)
* `incr.v`: Displacement, displaceability (Lemma 10)
* `ctx.v`: Context subsumption, weakening (Lemma 7),
  context regularity (Lemma 9), context restriction (Lemma 11)
* `restrict.v`: Restriction subsumption (Lemma 12), floating,
  restricted floating (Lemma 13), cumulativity (Lemma 14)
* `inversion.v`: Typing inversion, typing regularity (Lemma 9)
* `typesafety.v`: Context replacement, Preservation (Theorem 4), canonical forms,
  call-by-name reduction (Figure 10), progress (Theorem 5), type safety

## Statistics

```
github.com/AlDanial/cloc v 2.00  T=0.03 s (338.4 files/s, 126676.0 lines/s)
-------------------------------------------------------------------------------
File                             blank        comment           code
-------------------------------------------------------------------------------
StraTT_inf.v                       362            156           1065
StraTT_ott.v                        49             26            477
ctx.v                               53             17            323
typesafety.v                        21              9            322
restrict.v                          15              6            227
inversion.v                         18             20            219
basics.v                            38             10            205
subst.v                             11             15            204
incr.v                              14             14            121
tactics.v                            6              5             36
axioms.v                            14              9             31
-------------------------------------------------------------------------------
SUM:                               601            287           3230
-------------------------------------------------------------------------------
```